name: Custom ROM Build

on:
  workflow_dispatch: # Build-ni qo'lda ishga tushirish uchun

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Kodlarni yuklab olish
      - name: Checkout Repository
        uses: actions/checkout@v4

      # 2. Crave-ni o'rnatish
      - name: Install Crave CLI
        run: |
          curl -s https://raw.githubusercontent.com | bash
          sudo install crave /usr/local/bin

      # 3. crave.conf faylini yaratish (Siz so'ragan qism)
      - name: Configure Crave
        run: |
          echo "username: ${{ secrets.CRAVE_USERNAME }}" > crave.conf
          echo "authToken: ${{ secrets.CRAVE_TOKEN }}" >> crave.conf
          # Faylni to'g'ri joyga qo'yilganini tasdiqlash
          mkdir -p ~/.crave
          cp crave.conf ~/.crave/crave.conf

      # 4. Build-ni boshlash
      - name: Run Build Command
        run: |
          # 'crave run' buyrug'i orqali build-ni masofadan boshlaysiz
          # O'zingizning build buyrug'ingizni yozing (misol pastda)
          crave run -- "repo init -u https://github.com -b lineage-21.0 --git-lfs ; \
                        repo sync -c -j$(nproc --all) --force-sync --no-clone-bundle --no-tags ; \
                        source build/envsetup.sh ; \
                        lunch lineage_device-userdebug ; \
                        mka bacon"
                        
